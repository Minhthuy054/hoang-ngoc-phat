(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.manageLibsVersions={})})(this,function(t){"use strict";function e(t,e){"string"!=typeof t&&(e=t,t=e.name),this.name=t,this.libs=[],this.options=e=e||{};var n=this,i=e.libs||[];i.forEach(function(t){n.addLib(t)})}function n(t,e){"string"!=typeof t&&(e=t,t=e.name),this.name=t,this.options=e=e||{},this.versions=[],this.mandatory=e.mandatory;var n=this,i=e.versions||[];i.forEach(function(t){n.addVersion(t)})}function i(t,e){"string"!=typeof t&&(e=t,t=e.name),this.name=t,this.assets=[],this.options=e=e||{},this.defaultVersion=e.defaultVersion,this.disabled=e.disabled;var n=this,i=e.assets||[];i.forEach(function(t){n.addAsset(t)})}function o(t){this.type=t.type,this.path=t.path,this.attrs=t.attrs||{}}function s(t){var e=document.currentScript.parentNode;e.appendChild(t)}function r(t){return"_manageLibsVersions_"+t.bundle.name+"_"+t.name}function a(t){for(var e=document.getElementsByName(t),n=0;n<e.length;n+=1)if(e[n].checked)return e[n].value}function u(t,e,n,i){var o=r(t),s=document.createElement("input");s.type="radio",s.name=o,s.value=e,s.id=o+e,i&&m(s,i),n.appendChild(s);var a=document.createElement("label");return a.setAttribute("for",s.id),a.innerText=e,i&&m(a,i),n.appendChild(a),n}function c(t,e,n){return l("stylesheet",t,e,n)}function d(t,e,n){return l("script",t,e,n)}function l(t,e,n,i){var o={type:t,path:f(e,n)};return h(o,i)}function f(t,e){return p(t,"{{VERSION}}",e)}function h(t,e,n){return t.attrs=t.attrs||{},e&&(t.attrs.integrity=e,t.attrs.crossorigin=n||""),t}function p(t,e,n){return t.split(e).join(n)}function m(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}function v(t,e,n){t&&(void 0===n&&(n=!0),t.classList[n?"add":"remove"](e))}function b(){return{disabled:"disabled",class:"version-disabled",title:"This version is disabled"}}function y(t,e){t&&(void 0===e&&(e=!0),e=!!e,t.disabled=e,v(t,"version-disabled",e),t.setAttribute("title",e?"This version is disabled":""))}function g(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("HEAD",t),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?e():n(i.status))},i.send()})}e.prototype.addLib=function(t,e){var i=t instanceof n?t:new n(t,e);return i.bundle=this,this.libs.push(i),i},e.prototype.getLib=function(t){for(var e=this.libs,n=0;n<e.length;n+=1)if(e[n].name===t)return e[n];console.warn('Could not find requested library "'+t+'"')},e.prototype.getLibVersion=function(t,e){var n=this.getLib(t);if(n)return n.getVersionFallback(e);console.warn('Could not find requested library "'+t+'" and version "'+e+'"')},e.prototype.makeLibVersionsRadios=function(t,e,n){var i=this.getLib(t);return i&&(n=i.makeVersionsRadios(e,n)),n},e.prototype.fillPlaceholders=function(){this.libs.forEach(function(t){t.fillPlaceholders()})},e.prototype.insertLibVersionsRadioHere=function(t,e,n){n=this.makeLibVersionsRadios(t,e,n),s(n)},e.prototype.readSelectedVersionsNames=function(){var t={};return this.libs.forEach(function(e){t[e.name]=e.readSelectedVersionName()}),t},e.prototype.getAndSelectVersionsAssetsList=function(t){for(var e,n,i,o=this.libs,s=0,r=[];s<o.length;s+=1)e=o[s],n=t[e.name],i=e.getAndSelectVersionSpec(n),r=r.concat(i.assets);return r},n.prototype.addVersion=function(t,e){var n=t instanceof i?t:new i(t,e);return n.libSpec=this,this.versions.push(n),n},n.prototype.makeVersionsRadios=function(t,e){var n=this,i=!1;return t.forEach(function(t){var o=n.getVersion(t);o&&(i?e&&e.appendChild(document.createElement("br")):i=!0,e=o.makeRadio(e))}),e},n.prototype.fillPlaceholders=function(){var t=this,e='[data-manage-lib="'+this.name+'"]';document.querySelectorAll(e).forEach(function(e){var n=e.dataset.manageVersions;n=n.split(/[ ,;]+/),e.appendChild(t.makeVersionsRadios(n))})},n.prototype.readSelectedVersionName=function(){var t=r(this);return a(t)},n.prototype.getAndSelectVersionSpec=function(t){var e=this.getVersionFallback(t);return e?(e.selectRadio(),e):(this.selectRadioNone(),{assets:[]})},n.prototype.makeRadioNone=function(t){t=t||document.createDocumentFragment();var e=this.mandatory?b():null;return u(this,"(none)",t,e),this.radioNoneElement=t.lastChild.previousSibling,t},n.prototype.selectRadioNone=function(){this.radioNoneElement&&(this.radioNoneElement.checked=!0)},n.prototype.getVersionFallback=function(t){if("string"!=typeof t||"(none)"===t)return this.mandatory?(console.warn('No version requested for mandatory library "'+this.name+'".'),this.getDefaultVersion()):void 0;var e=this.getVersion(t);return e||(console.warn('Requested library "'+this.name+'" with version "'+t+'", but not found in configuration.'),this.getDefaultVersion())},n.prototype.getVersion=function(t){for(var e=this.versions||[],n=0;n<e.length;n+=1)if(e[n].name===t)return e[n]},n.prototype.getDefaultVersion=function(){var t=this._getDefaultVersion();if(t){console.log('Using default configuration (version: "'+t.name+'").');var e=this.options.onDefault;return e&&"function"==typeof e&&e.call(this),t}console.warn("No default configuration specified.");var n=this.options.onError;n&&"function"==typeof n&&n.call(this)},n.prototype._getDefaultVersion=function(){for(var t=this.versions||[],e=0;e<t.length;e+=1)if(t[e].defaultVersion)return t[e]},i.prototype.addAsset=function(t){t=t instanceof o?t:new o(t);return this.assets.push(t),this},i.prototype.checkAssetsAvailability=function(t){var e=[],n=this;this.assets.forEach(function(t){e.push(g(t.path))});var i=Promise.all(e);return t&&i.then(function(){n.setDisabled(!1)}).catch(function(){n.defaultVersion=!1,n.setDisabled(!0)}),i},i.prototype.setDisabled=function(t){t=!!t,this.disabled=t;var e=this.radioElement;if(e){y(e,t);var n=e.nextSibling;n&&y(n,t)}},i.prototype.makeRadio=function(t){t=t||document.createDocumentFragment();var e=this.disabled?b():null;return u(this.libSpec,this.name,t,e),this.radioElement=t.lastChild.previousSibling,t},i.prototype.selectRadio=function(){this.radioElement&&(this.radioElement.checked=!0)},t.Bundle=e,t.Lib=n,t.Version=i,t.Asset=o,t.makeScript=d,t.makeStylesheet=c});